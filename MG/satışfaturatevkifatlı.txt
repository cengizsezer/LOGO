USE [NETLINE_TIGER]
GO

/****** Object:  View [dbo].[AAMG_101_ALIS_SATIS_FATURA_TEVKİFATLI]    Script Date: 2/22/2025 6:20:34 PM ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO


ALTER VIEW [dbo].[AAMG_101_ALIS_SATIS_FATURA_TEVKİFATLI]
AS

SELECT 

'101_TEZ_MEDIKAL' AS Firma
--case WHEN INV.CANCELLED=1 THEN 'IPTAL' ELSE 'IPTAL DEGIL'  END 'IPTAL DURUMU'
,INV.FICHENO 'FATURA NO'
,INV.DATE_ 'FATURA TARIHI'
,INV.TRADINGGRP [TİCARİ_GRUP]
,MONTH (INV.DATE_) 'AY'
,YEAR (INV.DATE_) 'YIL'
,clc.code 'CARI KODU'
,CLC.DEFINITION_ 'ÜNVAN'
,CLC.TRADINGGRP [TİCARİ_GRUP_CLC]
,CLC.TAXNR 'V.NO'
,CLC.TCKNO
,CASE WHEN INV.TRCODE=1 THEN 'SATINALMA FATURASI'
     WHEN INV.TRCODE=4 THEN 'ALINAN HIZMET FATURASI' 
     WHEN INV.TRCODE=6 THEN 'SATIN ALMA İADE FATURASI' 
     WHEN INV.TRCODE=5 THEN 'ALINAN PROFORMA FATURA' 
     WHEN INV.TRCODE=2 THEN 'PARAKENDE İADE FATURASI' 
     WHEN INV.TRCODE=3 THEN 'TOPTAN SATIŞ İADE FATURASI' 
     WHEN INV.TRCODE=7 THEN 'PARAKENDE SATIŞ FATURASI' 
     WHEN INV.TRCODE=8 THEN 'TOPTAN SATIŞ FATURASI ' 
     WHEN INV.TRCODE=9 THEN 'VERİLEN HİZME FATURASI' 
 END AS 'FİŞ TÜRLERİ'
  ,srv.code [HIZMET_KODU]
,SRV.DEFINITION_ [HIZMET_ADI]
,STL.DEDUCTCODE 'TEVKIFAT_KODU'
,STL.DEDUCTIONPART1 'TEV_PAY'
,STL.DEDUCTIONPART2 'TEV_PAYDA'
,STL.VATMATRAH 'KDV MATRAH'
,STL.VAT 'KDV ORANI'
,STL.VATMATRAH*((STL.VAT)*0.01) '20 KDV'
,STL.VATMATRAH*((STL.VAT)*0.01)-ROUND(((STL.VATMATRAH / 100) * STL.VAT ) - STL.VATAMNT,2) 'TEV'


,ROUND(((STL.VATMATRAH / 100) * STL.VAT ) - STL.VATAMNT,2) 'TEVKIFAT'
,INV.NETTOTAL 'FAT TOPLAMI'

FROM LG_101_01_INVOICE INV  
INNER JOIN LG_101_01_STLINE STL ON STL.INVOICEREF=INV.LOGICALREF
INNER JOIN LG_101_CLCARD CLC ON CLC.LOGICALREF=INV.CLIENTREF
INNER JOIN LG_101_SRVCARD SRV ON SRV.LOGICALREF=STL.STOCKREF


WHERE INV.CANCELLED=0 AND YEAR (INV.DATE_) IN ('2024','2025') --AND INV.TRCODE IN (7,8,9) AND INV.CANCELLED=0





--STL.VATAMNT<>0 AND
--ROUND(ROUND((STL.VATMATRAH / 100),2) * STL.VAT,2) - STL.VATAMNT>1   AND STL.KKEGVATACCREF=0 AND STL.DEDUCTIONPART1<>''
UNION ALL


select 
'101_TEZ_MEDIKAL' AS Firma
,CLF.TRANNO 'FATURA NO'

,CLF.DATE_ 'FATURA TARIHI'
,'0' [TİCARİ_GRUP]
,MONTH (CLF.DATE_) 'AY'
,YEAR (CLF.DATE_) 'YIL'
,clc.code 'CARI KODU'
,CLC.DEFINITION_ 'ÜNVAN'
,CLC.TRADINGGRP [TİCARİ_GRUP_CLC]
,CLC.TAXNR 'V.NO'
,CLC.TCKNO
,'ALINAN SERBEST MESLEK MAKBUZU' 'FİŞ TÜRLERİ'
 , '0' [HIZMET_KODU]
,'0' [HIZMET_ADI]
,'0' 'TEVKIFAT_KODU'
, '0' 'TEV_PAY'
,'0' 'TEV_PAYDA'
,CLF.BRUTAMOUNT 'KDV MATRAH'
,CLF.VATRATE 'KDV ORANI'
,ROUND(((CLF.BRUTAMOUNT / 100) * CLF.VATRATE),2) '20 KDV'
,'0' 'TEV'


,'0' 'TEVKIFAT'
,CLF.AMOUNT 'FAT TOPLAMI'

from LG_101_01_CLFLINE CLF
LEFT JOIN LG_101_CLCARD CLC ON CLC.LOGICALREF=CLF.CLIENTREF
 WHERE CLF.TRCODE=46 AND  YEAR (CLF.DATE_) IN ('2024','2025')



 UNION ALL

 SELECT 

'105_TEZ_FILO' AS Firma
--case WHEN INV.CANCELLED=1 THEN 'IPTAL' ELSE 'IPTAL DEGIL'  END 'IPTAL DURUMU'
,INV.FICHENO 'FATURA NO'
,INV.DATE_ 'FATURA TARIHI'
,INV.TRADINGGRP [TİCARİ_GRUP]
,MONTH (INV.DATE_) 'AY'
,YEAR (INV.DATE_) 'YIL'
,clc.code 'CARI KODU'
,CLC.DEFINITION_ 'ÜNVAN'
,CLC.TRADINGGRP [TİCARİ_GRUP_CLC]
,CLC.TAXNR 'V.NO'
,CLC.TCKNO
,CASE WHEN INV.TRCODE=1 THEN 'SATINALMA FATURASI'
     WHEN INV.TRCODE=4 THEN 'ALINAN HIZMET FATURASI' 
     WHEN INV.TRCODE=6 THEN 'SATIN ALMA İADE FATURASI' 
     WHEN INV.TRCODE=5 THEN 'ALINAN PROFORMA FATURA' 
     WHEN INV.TRCODE=2 THEN 'PARAKENDE İADE FATURASI' 
     WHEN INV.TRCODE=3 THEN 'TOPTAN SATIŞ İADE FATURASI' 
     WHEN INV.TRCODE=7 THEN 'PARAKENDE SATIŞ FATURASI' 
     WHEN INV.TRCODE=8 THEN 'TOPTAN SATIŞ FATURASI ' 
     WHEN INV.TRCODE=9 THEN 'VERİLEN HİZME FATURASI' 
 END AS 'FİŞ TÜRLERİ'
  ,srv.code [HIZMET_KODU]
,SRV.DEFINITION_ [HIZMET_ADI]
,STL.DEDUCTCODE 'TEVKIFAT_KODU'
,STL.DEDUCTIONPART1 'TEV_PAY'
,STL.DEDUCTIONPART2 'TEV_PAYDA'
,STL.VATMATRAH 'KDV MATRAH'
,STL.VAT 'KDV ORANI'
,STL.VATMATRAH*((STL.VAT)*0.01) '20 KDV'
,STL.VATMATRAH*((STL.VAT)*0.01)-ROUND(((STL.VATMATRAH / 100) * STL.VAT ) - STL.VATAMNT,2) 'TEV'


,ROUND(((STL.VATMATRAH / 100) * STL.VAT ) - STL.VATAMNT,2) 'TEVKIFAT'
,INV.NETTOTAL 'FAT TOPLAMI'

FROM LG_105_01_INVOICE INV  
INNER JOIN LG_105_01_STLINE STL ON STL.INVOICEREF=INV.LOGICALREF
INNER JOIN LG_105_CLCARD CLC ON CLC.LOGICALREF=INV.CLIENTREF
INNER JOIN LG_105_SRVCARD SRV ON SRV.LOGICALREF=STL.STOCKREF


WHERE INV.CANCELLED=0 AND YEAR (INV.DATE_) IN ('2024','2025')  --AND INV.TRCODE IN (7,8,9) AND INV.CANCELLED=0





--STL.VATAMNT<>0 AND
--ROUND(ROUND((STL.VATMATRAH / 100),2) * STL.VAT,2) - STL.VATAMNT>1   AND STL.KKEGVATACCREF=0 AND STL.DEDUCTIONPART1<>''
UNION ALL


select 
'105_TEZ_FILO' AS Firma
,CLF.TRANNO 'FATURA NO'

,CLF.DATE_ 'FATURA TARIHI'
,'0' [TİCARİ_GRUP]
,MONTH (CLF.DATE_) 'AY'
,YEAR (CLF.DATE_) 'YIL'
,clc.code 'CARI KODU'
,CLC.DEFINITION_ 'ÜNVAN'
,CLC.TRADINGGRP [TİCARİ_GRUP_CLC]
,CLC.TAXNR 'V.NO'
,CLC.TCKNO
,'ALINAN SERBEST MESLEK MAKBUZU' 'FİŞ TÜRLERİ'
 , '0' [HIZMET_KODU]
,'0' [HIZMET_ADI]
,'0' 'TEVKIFAT_KODU'
, '0' 'TEV_PAY'
,'0' 'TEV_PAYDA'
,CLF.BRUTAMOUNT 'KDV MATRAH'
,CLF.VATRATE 'KDV ORANI'
,ROUND(((CLF.BRUTAMOUNT / 100) * CLF.VATRATE),2) '20 KDV'
,'0' 'TEV'


,'0' 'TEVKIFAT'
,CLF.AMOUNT 'FAT TOPLAMI'

from LG_105_01_CLFLINE CLF
LEFT JOIN LG_105_CLCARD CLC ON CLC.LOGICALREF=CLF.CLIENTREF
 WHERE CLF.TRCODE=46 AND  YEAR (CLF.DATE_) IN ('2024','2025')



 

 UNION ALL

 SELECT 

'106_BIZ_KLINIK' AS Firma
--case WHEN INV.CANCELLED=1 THEN 'IPTAL' ELSE 'IPTAL DEGIL'  END 'IPTAL DURUMU'
,INV.FICHENO 'FATURA NO'
,INV.DATE_ 'FATURA TARIHI'
,INV.TRADINGGRP [TİCARİ_GRUP]
,MONTH (INV.DATE_) 'AY'
,YEAR (INV.DATE_) 'YIL'
,clc.code 'CARI KODU'
,CLC.DEFINITION_ 'ÜNVAN'
,CLC.TRADINGGRP [TİCARİ_GRUP_CLC]
,CLC.TAXNR 'V.NO'
,CLC.TCKNO
,CASE WHEN INV.TRCODE=1 THEN 'SATINALMA FATURASI'
     WHEN INV.TRCODE=4 THEN 'ALINAN HIZMET FATURASI' 
     WHEN INV.TRCODE=6 THEN 'SATIN ALMA İADE FATURASI' 
     WHEN INV.TRCODE=5 THEN 'ALINAN PROFORMA FATURA' 
     WHEN INV.TRCODE=2 THEN 'PARAKENDE İADE FATURASI' 
     WHEN INV.TRCODE=3 THEN 'TOPTAN SATIŞ İADE FATURASI' 
     WHEN INV.TRCODE=7 THEN 'PARAKENDE SATIŞ FATURASI' 
     WHEN INV.TRCODE=8 THEN 'TOPTAN SATIŞ FATURASI ' 
     WHEN INV.TRCODE=9 THEN 'VERİLEN HİZME FATURASI' 
 END AS 'FİŞ TÜRLERİ'
  ,srv.code [HIZMET_KODU]
,SRV.DEFINITION_ [HIZMET_ADI]
,STL.DEDUCTCODE 'TEVKIFAT_KODU'
,STL.DEDUCTIONPART1 'TEV_PAY'
,STL.DEDUCTIONPART2 'TEV_PAYDA'
,STL.VATMATRAH 'KDV MATRAH'
,STL.VAT 'KDV ORANI'
,STL.VATMATRAH*((STL.VAT)*0.01) '20 KDV'
,STL.VATMATRAH*((STL.VAT)*0.01)-ROUND(((STL.VATMATRAH / 100) * STL.VAT ) - STL.VATAMNT,2) 'TEV'


,ROUND(((STL.VATMATRAH / 100) * STL.VAT ) - STL.VATAMNT,2) 'TEVKIFAT'
,INV.NETTOTAL 'FAT TOPLAMI'

FROM LG_106_01_INVOICE INV  
INNER JOIN LG_106_01_STLINE STL ON STL.INVOICEREF=INV.LOGICALREF
INNER JOIN LG_106_CLCARD CLC ON CLC.LOGICALREF=INV.CLIENTREF
INNER JOIN LG_106_SRVCARD SRV ON SRV.LOGICALREF=STL.STOCKREF


WHERE INV.CANCELLED=0 AND YEAR (INV.DATE_) IN ('2024','2025')  --AND INV.TRCODE IN (7,8,9) AND INV.CANCELLED=0





--STL.VATAMNT<>0 AND
--ROUND(ROUND((STL.VATMATRAH / 100),2) * STL.VAT,2) - STL.VATAMNT>1   AND STL.KKEGVATACCREF=0 AND STL.DEDUCTIONPART1<>''
UNION ALL


select 
'106_BIZ_KLINIK' AS Firma
,CLF.TRANNO 'FATURA NO'

,CLF.DATE_ 'FATURA TARIHI'

,'0' [TİCARİ_GRUP]
,MONTH (CLF.DATE_) 'AY'
,YEAR (CLF.DATE_) 'YIL'
,clc.code 'CARI KODU'
,CLC.DEFINITION_ 'ÜNVAN'
,CLC.TRADINGGRP [TİCARİ_GRUP_CLC]
,CLC.TAXNR 'V.NO'
,CLC.TCKNO
,'ALINAN SERBEST MESLEK MAKBUZU' 'FİŞ TÜRLERİ'
 , '0' [HIZMET_KODU]
,'0' [HIZMET_ADI]
,'0' 'TEVKIFAT_KODU'
, '0' 'TEV_PAY'
,'0' 'TEV_PAYDA'
,CLF.BRUTAMOUNT 'KDV MATRAH'
,CLF.VATRATE 'KDV ORANI'
,ROUND(((CLF.BRUTAMOUNT / 100) * CLF.VATRATE),2) '20 KDV'
,'0' 'TEV'


,'0' 'TEVKIFAT'
,CLF.AMOUNT 'FAT TOPLAMI'

from LG_106_01_CLFLINE CLF
LEFT JOIN LG_106_CLCARD CLC ON CLC.LOGICALREF=CLF.CLIENTREF
 WHERE CLF.TRCODE=46 AND  YEAR (CLF.DATE_) IN ('2024','2025')

 
 UNION ALL

 SELECT 

'107_TEZMED_HOL' AS Firma
--case WHEN INV.CANCELLED=1 THEN 'IPTAL' ELSE 'IPTAL DEGIL'  END 'IPTAL DURUMU'
,INV.FICHENO 'FATURA NO'
,INV.DATE_ 'FATURA TARIHI'
,INV.TRADINGGRP [TİCARİ_GRUP]
,MONTH (INV.DATE_) 'AY'
,YEAR (INV.DATE_) 'YIL'
,clc.code 'CARI KODU'
,CLC.DEFINITION_ 'ÜNVAN'
,CLC.TRADINGGRP [TİCARİ_GRUP_CLC]
,CLC.TAXNR 'V.NO'
,CLC.TCKNO
,CASE WHEN INV.TRCODE=1 THEN 'SATINALMA FATURASI'
     WHEN INV.TRCODE=4 THEN 'ALINAN HIZMET FATURASI' 
     WHEN INV.TRCODE=6 THEN 'SATIN ALMA İADE FATURASI' 
     WHEN INV.TRCODE=5 THEN 'ALINAN PROFORMA FATURA' 
     WHEN INV.TRCODE=2 THEN 'PARAKENDE İADE FATURASI' 
     WHEN INV.TRCODE=3 THEN 'TOPTAN SATIŞ İADE FATURASI' 
     WHEN INV.TRCODE=7 THEN 'PARAKENDE SATIŞ FATURASI' 
     WHEN INV.TRCODE=8 THEN 'TOPTAN SATIŞ FATURASI ' 
     WHEN INV.TRCODE=9 THEN 'VERİLEN HİZME FATURASI' 
 END AS 'FİŞ TÜRLERİ'
  ,srv.code [HIZMET_KODU]
,SRV.DEFINITION_ [HIZMET_ADI]
,STL.DEDUCTCODE 'TEVKIFAT_KODU'
,STL.DEDUCTIONPART1 'TEV_PAY'
,STL.DEDUCTIONPART2 'TEV_PAYDA'
,STL.VATMATRAH 'KDV MATRAH'
,STL.VAT 'KDV ORANI'
,STL.VATMATRAH*((STL.VAT)*0.01) '20 KDV'
,STL.VATMATRAH*((STL.VAT)*0.01)-ROUND(((STL.VATMATRAH / 100) * STL.VAT ) - STL.VATAMNT,2) 'TEV'


,ROUND(((STL.VATMATRAH / 100) * STL.VAT ) - STL.VATAMNT,2) 'TEVKIFAT'
,INV.NETTOTAL 'FAT TOPLAMI'

FROM LG_107_01_INVOICE INV  
INNER JOIN LG_107_01_STLINE STL ON STL.INVOICEREF=INV.LOGICALREF
INNER JOIN LG_107_CLCARD CLC ON CLC.LOGICALREF=INV.CLIENTREF
INNER JOIN LG_107_SRVCARD SRV ON SRV.LOGICALREF=STL.STOCKREF


WHERE INV.CANCELLED=0 AND YEAR (INV.DATE_) IN ('2024','2025') --AND INV.TRCODE IN (7,8,9) AND INV.CANCELLED=0





--STL.VATAMNT<>0 AND
--ROUND(ROUND((STL.VATMATRAH / 100),2) * STL.VAT,2) - STL.VATAMNT>1   AND STL.KKEGVATACCREF=0 AND STL.DEDUCTIONPART1<>''
UNION ALL


select 
'107_TEZMED_HOL' AS Firma
,CLF.TRANNO 'FATURA NO'
,CLF.DATE_ 'FATURA TARIHI'
,'0' [TİCARİ_GRUP]
,MONTH (CLF.DATE_) 'AY'
,YEAR (CLF.DATE_) 'YIL'
,clc.code 'CARI KODU'
,CLC.DEFINITION_ 'ÜNVAN'
,CLC.TRADINGGRP [TİCARİ_GRUP_CLC]
,CLC.TAXNR 'V.NO'
,CLC.TCKNO
,'ALINAN SERBEST MESLEK MAKBUZU' 'FİŞ TÜRLERİ'
 , '0' [HIZMET_KODU]
,'0' [HIZMET_ADI]
,'0' 'TEVKIFAT_KODU'
, '0' 'TEV_PAY'
,'0' 'TEV_PAYDA'
,CLF.BRUTAMOUNT 'KDV MATRAH'
,CLF.VATRATE 'KDV ORANI'
,ROUND(((CLF.BRUTAMOUNT / 100) * CLF.VATRATE),2) '20 KDV'
,'0' 'TEV'


,'0' 'TEVKIFAT'
,CLF.AMOUNT 'FAT TOPLAMI'

from LG_107_01_CLFLINE CLF
LEFT JOIN LG_107_CLCARD CLC ON CLC.LOGICALREF=CLF.CLIENTREF
 WHERE CLF.TRCODE=46 AND  YEAR (CLF.DATE_) IN ('2024','2025')



  UNION ALL

 SELECT 

'108_TEZ_INOV' AS Firma
--case WHEN INV.CANCELLED=1 THEN 'IPTAL' ELSE 'IPTAL DEGIL'  END 'IPTAL DURUMU'
,INV.FICHENO 'FATURA NO'
,INV.DATE_ 'FATURA TARIHI'
,INV.TRADINGGRP [TİCARİ_GRUP]
,MONTH (INV.DATE_) 'AY'
,YEAR (INV.DATE_) 'YIL'
,clc.code 'CARI KODU'
,CLC.DEFINITION_ 'ÜNVAN'
,CLC.TRADINGGRP [TİCARİ_GRUP_CLC]
,CLC.TAXNR 'V.NO'
,CLC.TCKNO
,CASE WHEN INV.TRCODE=1 THEN 'SATINALMA FATURASI'
     WHEN INV.TRCODE=4 THEN 'ALINAN HIZMET FATURASI' 
     WHEN INV.TRCODE=6 THEN 'SATIN ALMA İADE FATURASI' 
     WHEN INV.TRCODE=5 THEN 'ALINAN PROFORMA FATURA' 
     WHEN INV.TRCODE=2 THEN 'PARAKENDE İADE FATURASI' 
     WHEN INV.TRCODE=3 THEN 'TOPTAN SATIŞ İADE FATURASI' 
     WHEN INV.TRCODE=7 THEN 'PARAKENDE SATIŞ FATURASI' 
     WHEN INV.TRCODE=8 THEN 'TOPTAN SATIŞ FATURASI ' 
     WHEN INV.TRCODE=9 THEN 'VERİLEN HİZME FATURASI' 
 END AS 'FİŞ TÜRLERİ'
  ,srv.code [HIZMET_KODU]
,SRV.DEFINITION_ [HIZMET_ADI]
,STL.DEDUCTCODE 'TEVKIFAT_KODU'
,STL.DEDUCTIONPART1 'TEV_PAY'
,STL.DEDUCTIONPART2 'TEV_PAYDA'
,STL.VATMATRAH 'KDV MATRAH'
,STL.VAT 'KDV ORANI'
,STL.VATMATRAH*((STL.VAT)*0.01) '20 KDV'
,STL.VATMATRAH*((STL.VAT)*0.01)-ROUND(((STL.VATMATRAH / 100) * STL.VAT ) - STL.VATAMNT,2) 'TEV'


,ROUND(((STL.VATMATRAH / 100) * STL.VAT ) - STL.VATAMNT,2) 'TEVKIFAT'
,INV.NETTOTAL 'FAT TOPLAMI'

FROM LG_108_01_INVOICE INV  
INNER JOIN LG_108_01_STLINE STL ON STL.INVOICEREF=INV.LOGICALREF
INNER JOIN LG_108_CLCARD CLC ON CLC.LOGICALREF=INV.CLIENTREF
INNER JOIN LG_108_SRVCARD SRV ON SRV.LOGICALREF=STL.STOCKREF


WHERE INV.CANCELLED=0 AND YEAR (INV.DATE_)IN ('2024','2025') --AND INV.TRCODE IN (7,8,9) AND INV.CANCELLED=0





--STL.VATAMNT<>0 AND
--ROUND(ROUND((STL.VATMATRAH / 100),2) * STL.VAT,2) - STL.VATAMNT>1   AND STL.KKEGVATACCREF=0 AND STL.DEDUCTIONPART1<>''
UNION ALL


select 
'108_TEZ_INOV' AS Firma
,CLF.TRANNO 'FATURA NO'

,CLF.DATE_ 'FATURA TARIHI'
,'0' [TİCARİ_GRUP]
,MONTH (CLF.DATE_) 'AY'
,YEAR (CLF.DATE_) 'YIL'
,clc.code 'CARI KODU'
,CLC.DEFINITION_ 'ÜNVAN'
,CLC.TRADINGGRP [TİCARİ_GRUP_CLC]
,CLC.TAXNR 'V.NO'
,CLC.TCKNO
,'ALINAN SERBEST MESLEK MAKBUZU' 'FİŞ TÜRLERİ'
 , '0' [HIZMET_KODU]
,'0' [HIZMET_ADI]
,'0' 'TEVKIFAT_KODU'
, '0' 'TEV_PAY'
,'0' 'TEV_PAYDA'
,CLF.BRUTAMOUNT 'KDV MATRAH'
,CLF.VATRATE 'KDV ORANI'
,ROUND(((CLF.BRUTAMOUNT / 100) * CLF.VATRATE),2) '20 KDV'
,'0' 'TEV'


,'0' 'TEVKIFAT'
,CLF.AMOUNT 'FAT TOPLAMI'

from LG_108_01_CLFLINE CLF
LEFT JOIN LG_108_CLCARD CLC ON CLC.LOGICALREF=CLF.CLIENTREF
 WHERE CLF.TRCODE=46 AND  YEAR (CLF.DATE_)  IN ('2024','2025')




 UNION ALL

 SELECT 

'101_TEZ_MEDIKAL' AS Firma
--case WHEN INV.CANCELLED=1 THEN 'IPTAL' ELSE 'IPTAL DEGIL'  END 'IPTAL DURUMU'
,INV.FICHENO 'FATURA NO'
,INV.DATE_ 'FATURA TARIHI'
,INV.TRADINGGRP [TİCARİ_GRUP]
,MONTH (INV.DATE_) 'AY'
,YEAR (INV.DATE_) 'YIL'
,clc.code 'CARI KODU'
,CLC.DEFINITION_ 'ÜNVAN'
,CLC.TRADINGGRP [TİCARİ_GRUP_CLC]
,CLC.TAXNR 'V.NO'
,CLC.TCKNO
,CASE WHEN INV.TRCODE=1 THEN 'SATINALMA FATURASI'
     WHEN INV.TRCODE=4 THEN 'ALINAN HIZMET FATURASI' 
     WHEN INV.TRCODE=6 THEN 'SATIN ALMA İADE FATURASI' 
     WHEN INV.TRCODE=5 THEN 'ALINAN PROFORMA FATURA' 
     WHEN INV.TRCODE=2 THEN 'PARAKENDE İADE FATURASI' 
     WHEN INV.TRCODE=3 THEN 'TOPTAN SATIŞ İADE FATURASI' 
     WHEN INV.TRCODE=7 THEN 'PARAKENDE SATIŞ FATURASI' 
     WHEN INV.TRCODE=8 THEN 'TOPTAN SATIŞ FATURASI ' 
     WHEN INV.TRCODE=9 THEN 'VERİLEN HİZME FATURASI' 
 END AS 'FİŞ TÜRLERİ'
  ,srv.code [HIZMET_KODU]
,SRV.DEFINITION_ [HIZMET_ADI]
,STL.DEDUCTCODE 'TEVKIFAT_KODU'
,STL.DEDUCTIONPART1 'TEV_PAY'
,STL.DEDUCTIONPART2 'TEV_PAYDA'
,STL.VATMATRAH 'KDV MATRAH'
,STL.VAT 'KDV ORANI'
,STL.VATMATRAH*((STL.VAT)*0.01) '20 KDV'
,STL.VATMATRAH*((STL.VAT)*0.01)-ROUND(((STL.VATMATRAH / 100) * STL.VAT ) - STL.VATAMNT,2) 'TEV'


,ROUND(((STL.VATMATRAH / 100) * STL.VAT ) - STL.VATAMNT,2) 'TEVKIFAT'
,INV.NETTOTAL 'FAT TOPLAMI'

FROM LG_201_01_INVOICE INV  
INNER JOIN LG_201_01_STLINE STL ON STL.INVOICEREF=INV.LOGICALREF
INNER JOIN LG_201_CLCARD CLC ON CLC.LOGICALREF=INV.CLIENTREF
INNER JOIN LG_201_SRVCARD SRV ON SRV.LOGICALREF=STL.STOCKREF


WHERE INV.CANCELLED=0 AND YEAR (INV.DATE_) IN ('2024','2025') --AND INV.TRCODE IN (7,8,9) AND INV.CANCELLED=0





--STL.VATAMNT<>0 AND
--ROUND(ROUND((STL.VATMATRAH / 100),2) * STL.VAT,2) - STL.VATAMNT>1   AND STL.KKEGVATACCREF=0 AND STL.DEDUCTIONPART1<>''
UNION ALL


select 
'101_TEZ_MEDIKAL' AS Firma
,CLF.TRANNO 'FATURA NO'

,CLF.DATE_ 'FATURA TARIHI'
,'0' [TİCARİ_GRUP]
,MONTH (CLF.DATE_) 'AY'
,YEAR (CLF.DATE_) 'YIL'
,clc.code 'CARI KODU'
,CLC.DEFINITION_ 'ÜNVAN'
,CLC.TRADINGGRP [TİCARİ_GRUP_CLC]
,CLC.TAXNR 'V.NO'
,CLC.TCKNO
,'ALINAN SERBEST MESLEK MAKBUZU' 'FİŞ TÜRLERİ'
 , '0' [HIZMET_KODU]
,'0' [HIZMET_ADI]
,'0' 'TEVKIFAT_KODU'
, '0' 'TEV_PAY'
,'0' 'TEV_PAYDA'
,CLF.BRUTAMOUNT 'KDV MATRAH'
,CLF.VATRATE 'KDV ORANI'
,ROUND(((CLF.BRUTAMOUNT / 100) * CLF.VATRATE),2) '20 KDV'
,'0' 'TEV'


,'0' 'TEVKIFAT'
,CLF.AMOUNT 'FAT TOPLAMI'

from LG_201_01_CLFLINE CLF
LEFT JOIN LG_201_CLCARD CLC ON CLC.LOGICALREF=CLF.CLIENTREF
 WHERE CLF.TRCODE=46 AND  YEAR (CLF.DATE_) IN ('2024','2025')





GO
